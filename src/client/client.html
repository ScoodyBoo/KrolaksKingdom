<!DOCTYPE html>
<html>
<head>
	<title>Krolak Nations</title>
</head>
<body>



    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
    <!-- have a button POST a click via AJAX -->
    <!-- <button hx-post="/clicked" hx-swap="outerHTML">
        Click Me
    </button> -->
    <!-- HTMX Example - issue HTTP GET request to /clicked , hx-swap will replace this entire content with the return of the HTTP GET HTML-->
    <!-- <button hx-post="/clicked"
        hx-trigger="click"
        hx-target="#parent-div"
        hx-swap="outerHTML">
        Click Me!
    </button> -->


	<h1>Krolak Nations</h1>
    <div id="message-panel">
        <input id="messageInput" placeholder="Type a message..." />
        <button onclick="sendMessage()">Send</button>
        <ul id="messages"></ul>
    </div>

    <!-- login / auth -->
                                                                    <!-- REGISTER PANEL -->
    <div id="register-panel">
        <p>Register New Account</p>
        <input id="regEmailInput" placeholder="email" />
        <ul id="regEmailInput"></ul>

        <input id="regUsernameInput" placeholder="username" />
        <ul id="regUsernameInput"></ul>

        <input id="regPasswordInput" placeholder="password" type="password" />
        <ul id="regPasswordInput"></ul>
        <input id="regPasswordConfirmInput" placeholder="confirm password" type="password" />
        <ul id="regPasswordConfirmInput"></ul>

        <button onclick="tryRegister()">register</button>
        <button onclick="gotoLogin()">back</button>
        <p id="register-connection-error-text">Error: Example</p>
    </div>
                                                                    <!-- LOGIN PANEL -->
    <div id="login-panel">
        <p id="status">Status: Connecting...</p>
        <input id="loginUsernameInput" placeholder="username" />
        <ul id="loginUsernameInput"></ul>

        <input id="loginPasswordInput" placeholder="password" />
        <ul id="loginPasswordInput"></ul>
        <button onclick="tryLogin()">login</button>
        <button onclick="gotoRegister()">register new account</button>
        <p id="login-connection-error-text">Error: Example</p>
    </div>



<!-- UXWFqxKU2qA -->
    


	<script>
        // websok implementation
		const socket = new WebSocket("ws://127.0.0.1:8453");
		socket.onopen = () => {
			console.log("Connected to server");
            statusText.textContent = "Server Status: Online";
		};
        socket.onclose = () => {
            console.log("Disconnected from server");
            statusText.textContent = "Server Status: Offline";
        };
        socket.onerror = (error) => {
            console.error("WebSocket error:", error);
            statusText.textContent = "Server Status: ‚ö†Ô∏è Error";
        };



        // Login & Auth Implementation
        const statusText = document.getElementById("status");
        const loginConnectionErrorText = document.getElementById("login-connection-error-text");
        const registerConnectionErrorText = document.getElementById("register-connection-error-text");

        const messagePanel = document.getElementById("message-panel")
        const registerPanel = document.getElementById("register-panel")
        const loginPanel = document.getElementById("login-panel")



        function showLoginPanel() {
            loginPanel.style.display = "block";
        }
        function showRegisterPanel() {
            registerPanel.style.display = "block";
        }

        function showMessagePanel() {
            messagePanel.style.display = "block";
        }
        function hideAuthPanels() {
            loginPanel.style.display = "none";
            messagePanel.style.display = "none";
            registerPanel.style.display = "none";
        }

        function tryRegister() {
            const username =        document.getElementById("regUsernameInput").value;
            const email =           document.getElementById("regEmailInput").value;
            const password =        document.getElementById("regPasswordInput").value;
            const passwordConfirm = document.getElementById("regPasswordConfirmInput").value;
            // üîπ Username length between 4 and 6
            if (username.length < 4 || username.length > 6) {
                alert("Username must be between 4 and 6 characters.");
                return;
            }
            // üîπ Email validation using simple regex
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(email)) {
                alert("Please enter a valid email address.");
                return;
            }

            // üîπ Password strength: min 8 chars, includes letter and number
            const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+]{8,}$/;
            if (!passwordPattern.test(password)) {
                alert("Password must be at least 8 characters long and include a letter and a number.");
                return;
            }

            // üîπ Confirm password
            if (password !== passwordConfirm) {
                alert("Passwords do not match.");
                return;
            }

            const payload = {
                type:"register",
                username:username,
                password: password,
                email: email
            };
            socket.send(JSON.stringify(payload));
        }
        function tryLogin() {
            const loginUsernameInput = document.getElementById("loginUsernameInput")
            const loginPasswordInput = document.getElementById("loginPasswordInput")


            const username = loginUsernameInput.value;
            const password = loginPasswordInput.value;
            
            const payload = {
                type:"login",
                username:username,
                password: password
            };

            socket.send(JSON.stringify(payload));
            
        }

        
        function gotoRegister() {
            hideAuthPanels();
            showRegisterPanel();
        }
        function gotoLogin() {
            
            hideAuthPanels();
            showLoginPanel();
            loginConnectionErrorText.textContent = "login or register"
        }







		socket.onmessage = (event) => {
			// const li = document.createElement("li");
			// li.textContent = event.data;
			// document.getElementById("messages").appendChild(li);
            loginConnectionErrorText.textContent = event.data
            registerConnectionErrorText.textContent = event.data
		};

		function sendMessage() {
			const input = document.getElementById("messageInput");
            const payload = {
                type:"message",
                username: username,
                message:input.value
            };

            socket.send(JSON.stringify(payload));
			input.value = "";
		}

        gotoLogin()
	</script>

</body>
</html>
